<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.zerock.mapper.BoardMapper">

<sql id="criteria">
	<trim prefix=" (" suffix=") " prefixOverrides="OR">
	  <foreach item='type' collection="typeArr">
	    <trim prefix="OR">
	      <choose>
	        <when test="type == 'T'.toString()"> title like '%'||#{keyword}||'%' </when>
	        <when test="type == 'C'.toString()"> content like '%'||#{keyword}||'%' </when>
	        <when test="type == 'W'.toString()"> writer like '%'||#{keyword}||'%' </when>
	      </choose>
	    </trim>
	  </foreach>
	</trim>
</sql>

<select id="getList" resultType="org.zerock.domain.BoardVO">
<![CDATA[
select * from tbl_board where bno > 0
]]>
</select>
<insert id="insert">
	insert into tbl_board (title, content, writer)
	values (#{title}, #{content}, #{writer})
</insert>


<insert id="insertSelectKey">
	insert into tbl_board (title, content, writer)
	values(#{title}, #{content}, #{writer})
	<selectKey keyProperty="bno" order="AFTER" resultType="long">
		select ISEQ$$_75341.currval from dual
	</selectKey>
</insert>
<select id="read" resultType="org.zerock.domain.BoardVO">
select * from tbl_board where bno = #{bno}
</select>
<delete id="delete">
delete tbl_board where bno = #{bno}
</delete>
<update id="update">
update tbl_board
set title=#{title}, content=#{content}, writer=#{writer}, updateDate=sysdate
where bno=#{bno}
</update>


<select id="getListWithPaging" resultType="org.zerock.domain.BoardVO">
<![CDATA[
select bno, title, content, writer, regDate, updateDate
from (
    select /*+INDEX_DESC(tbl_board pk_board) */   -- 실행 계획
    rownum rn, bno, title, content, writer, regDate, updateDate
    from tbl_board
    where
]]>
<trim prefix="(" suffix=") AND " prefixOverrides="OR">
    <foreach item='type' collection="typeArr">
      <trim prefix="OR">
        <choose>
	 <when test="type == 'T'.toString()"> title like '%'||#{keyword}||'%' </when>
          <when test="type == 'C'.toString()"> content like '%'||#{keyword}||'%' </when>
          <when test="type == 'W'.toString()"> writer like '%'||#{keyword}||'%' </when>
        </choose>
      </trim>
    </foreach>
</trim>
<![CDATA[  
     rownum <= #{pageNum} * #{amount}
)
where rn > (#{pageNum} - 1) * #{amount}
]]>
</select>



<select id="getListWithPaging2" resultType="org.zerock.domain.BoardVO">
select /*+index_desc(tbl_board pk_board) */
*
from
tbl_board

<where>
  <if test="typeArr != null">
  
	<include refid="criteria"></include>
  </if>
</where>
offset (#{pageNum} - 1) * #{amount} rows fetch next #{amount} rows only
</select>

<select id="getTotalCount" resultType="int">
	select count(*) from tbl_board where
	<trim suffix=" and ">
		<if test="typeArr != null">
			<include refid="criteria"></include>
		</if>
	</trim>
	 bno > 0
</select>
</mapper>